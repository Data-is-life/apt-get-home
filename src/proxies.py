from lxml.html import fromstring
import requests
import time
import traceback
import random

proxies = ['104.236.47.73:8080', '216.27.126.84:48414',
            '216.241.207.246:57080', '50.76.120.181:36304',
            '71.91.129.249:45724', '69.250.7.53:47211',
            '38.88.154.218:50860', '24.173.244.146:21231',
            '216.82.192.201:49052', '47.206.13.115:46128',
            '37.61.224.242:8195', '12.189.124.55:59128',
            '40.138.3.210:48761', '70.183.205.174:33721',
            '71.183.100.76:53613', '74.113.169.129:39679',
            '173.54.193.242:44674', '65.117.185.106:54013',
            '50.84.155.10:50353', '75.176.232.154:38128', 
            '199.127.121.38:33791', '50.192.195.69:50693',
            '206.51.155.14:45999', '98.190.159.51:43217',
            '207.59.160.178:57087', '50.245.151.237:57394',
            '24.229.120.65:32857', '199.200.28.252:41535',
            '68.177.70.199:56924', '166.150.131.82:34247',
            '173.171.132.82:30977', '50.244.54.36:38480',
            '68.39.227.243:50438', '199.189.151.33:41074',
            '173.163.68.105:38705', '76.191.74.140:61126',
            '98.26.32.15:58814', '96.94.185.189:47778',
            '199.200.31.6:48546', '216.45.89.234:46720',
            '99.56.147.242:32931', '199.21.106.126:55860',
            '50.234.107.15:43429', '96.70.52.227:32761',
           '166.141.153.31:32231', '97.68.247.134:43710',
           '96.84.111.89:56587', '206.51.155.246:57809',
           '47.210.133.169:36158', '73.243.211.15:52847',
           '64.246.119.83:46778', '65.173.110.100:43386',
           '96.93.156.146:56599', '207.177.5.111:60827',
           '24.249.56.148:37242', '74.84.121.206:42636',
           '98.190.57.93:34049', '159.203.119.243:41397',
           '64.135.223.254:33338', '192.249.55.14:33539',
           '204.153.129.234:51456', '18.222.84.229:53281',
           '24.35.1.7:39042', '162.245.81.234:40623',
           '12.183.155.68:36646', '98.190.18.187:57729',
           '12.30.127.18:50095', '173.209.169.216:40245',
           '63.97.79.227:37686', '96.2.94.149:34239',
           '216.198.231.50:61601', '52.124.29.50:37752',
           '205.145.146.34:50119', '205.145.144.108:31646',
           '12.2.202.242:8080', '24.148.73.79:8080', '50.224.173.179:8080',
           '64.125.223.19:55577', '64.125.223.19:55577', '72.35.40.34:8080',
           '98.150.241.216:8080', '140.227.60.114:3128', '173.164.26.117:3128',
           '107.165.144.125:45931', '37.224.84.90:8080', '207.144.111.230:8080',
           '51.15.21.103:80', '31.146.150.254:8888', '64.214.77.66:8080']

url = 'https://httpbin.org/ip'
default_list = []

for i in range(0, len(proxies)):
    # Get a proxy from the pool
    proxy = proxies[i]
    print(i+1)
    start_time = time.time()
    print(default_list)
    try:
        response = requests.get(url, proxies={"http": proxy, "https": proxy})
        print(response.json())
        print(time.time() - start_time)
        print(default_list)
    except:
        print("Skipping. Connnection error")
        default_list.append(i+1)
        print(time.time() - start_time)
        print(default_list)
